%-------------------MODEL-------------------------
\subsection{Atmospheric Model}
\label{sec:CAM}
To evaluate Earth rotation data as an assimilation variable, we assimilate synthetic observations into the Community Atmosphere Model 5 \citep[CAM5]{nealeetal2010}, which forms the atmospheric component of the Community Earth System Model. 
We have run CAM with a finite-volume dynamical core, $1.9^{\text{o}} \times 2.5^{\text{o}}$ horizontal resolution, and  30 hybrid-coordinate vertical levels, the highest of which is near 3 hPa.
The top three model levels (starting at about 14 hPa) constitute a ``sponge'' layer, where horizontal diffusion is applied to temperature, vorticity, and divergence in order to absorb vertically propagating planetary waves.  
The diffusion has been tuned in order to give a reasonable strength of the stratospheric polar night jets \citep{nealeetal2010}.

%-------------------DAS-------------------------


\subsection{Data Assimilation System}
\label{sec:DAS}
The Data Assimilation Research Testbed  \citep[DART]{Anderson2009, Raeder2012} provides an ensemble-based data assimilation interface for CAM (among many other atmosphere and ocean models). 
Our experiments use the Ensemble Adjustment Kalman Filter (EAKF) \citep{anderson2001}, which is one of several ensemble assimilation algorithms available within DART.
The following section outlines the basic algorithm of this ensemble filter.

To assimilate observations, the filter requires an ensemble of $N$ simulations to be advanced forward to the time at which a given observation becomes available. 
At this time, the filter unites two basic quantities: the observation itself, $y_{\text{obs}}$, and $N$ values of the observation that are predicted by the ensemble ($y_{b}^{n}$, where $b$ denotes the \textit{background} estimate and $n$ denotes an individual ensemble member).
Bayes' theorem states that the conditional probability distribution of the observation, given the prior ensemble estimate on the one handm, and the physical measurement on the other, is the product of their respective probability distributions.
The resulting joint probability distribution has an updated variance $\sigma_a^2$  (where $a$ denotes the update or \textit{analysis}):
\begin{eqnarray}
 \sigma_a^2 = 
\left[
\left( \sigma_b^2  \right)^{-1}+
\left( \sigma_{\text{obs}}^2  \right)^{-1}
\right]^{-1},
\label{eq:sigma_a}
\end{eqnarray}
where $\sigma_b^2$ is  the prior error variance of the observation implied by the ensemble, and $\sigma_{\text{obs}}^2$ is the error variance of the observation itself (i.e. the measurement error).
The ensemble mean of this joint probability distribution is given by
\begin{eqnarray}
\left< y_a \right> = \sigma_a^2 
\left(
\frac{\left< y_b \right>}{\sigma_b^2} +
\frac{y_{\text{obs}} }{\sigma_{\text{obs}}^2} 
\right).
\end{eqnarray}
This means that the observation value of each ensemble member should be updated to the following:
\begin{eqnarray}
 y_{a}^n = 
\left( \frac{\sigma_a^2}{\sigma_b^2}  \right)
\left(
y_{b}^n - \left< y_b  \right> \right)
+ \left< y_a \right>,
\end{eqnarray}
i.e. a linear transformation of the ensemble members about the updated mean such that (\ref{eq:sigma_a}) is satisfied by the ensemble \citep{andersoncollins2006}.

Practically, of course, we don't update the \textit{observation} implied by the ensemble, but rather the \textit{state} of each ensemble member (in our case the wind, surface pressure, and temperature fields). 
To update the state vector of each ensemble member, ${\bf x}^n$ with the information from the observation, we simply project the observation space update for each ensemble member ($\Delta y^n = y_{a}^n-y_{b}^n$) onto the individual state components $x_i$ via linear regression:
\begin{eqnarray}
 \Delta x_{i}^n = 
\left(
\frac{c_{x_iy}}{\sigma_b^2}
\right)
\Delta y^n,
\label{eq:state_update}
\end{eqnarray}
where $c_{x_iy}$ represents the prior covariance between the state component $x_i$ and the observation $y$.

%---cut---(it's not really relevant)
%Because the EAKF adjusts the ensemble based on the expected error reduction, it is called a stochastic ensemble filter.
%In contrast, so-called stochastic filters, such as the well-known Ensemble Kalman Filter \citep{evensen2003}, adjust the forecast ensemble first with perturbed upservations, and then compute the resulting error distribution from the ensemble.

Ensemble assimilation algorithms are novel because they estimate the covariance and variance terms in the above equations using an ensemble of model simulations, which means that these quantities can vary in time and space (according to the physical relationships simulated in the model), and are updated with new information whenever a new observation comes in.  
For example, the covariance between model state component $x_i$ and observation $y_j$ is given by
\begin{eqnarray}
c_{x_iy_j} &=& 
\left<
e_{x_i}^n 
e_{y_j}^n
\right>,
\label{eq:covariance} 
\end{eqnarray}
%
%\sigma_b^2 &=& 
%\left<
%\left( y_{b,n} - \left< y_b \right>   \right)^2
%\right>  
%\label{eq:sigma_b} \\
%
%\sigma_a^2 &=& 
%\left<
%\left( y_{a,n} - \left< y_a \right>   \right)^2
%\right>,  
%\label{eq:sigma_a} 
%
where the brackets $\left< \cdot \right>$ represent the ensemble mean and
$e_{x_i}^n = x_i^n - \left< x_i^n \right>   $ and $e_{y_j}^n = y_j^n - \left< y_j^n \right> $ are the deviations of each ensemble member (denoted by the superscript $n$) from the ensemble mean.

In a successful ensemble assimilation system, these terms should reflect the true error statistics of the model system.
If this is not the case, the ensemble filter will diverge, a condition where the uncertainty predicted by the ensemble underestimates the true error, which eventually leads to the rejection of new observations.
\textcolor{alert}{Note: in our experiments, this kind of filter divergence is not really the problem, so maybe rephrase what I said here, or cut it completely.}

%

%-------------------observations-------------------------

\subsection{Synthetic Observations}

To evaluate the impact of Earth rotation observations relative to more conventional (localized) observations in a data assimilation system, we generate synthetic observations from a reference model simulation that we call the "truth", then assimilate these observations into a an ensemble of model simulations spread around the truth.  

The truth run comes from a reference CAM simulation that starts on 1 Jan 2008 and uses observed sea surface temperatures as a boundary condition. 
We generate observations of this run from 1 January to 28 February 2009 of this simulation. 


\subsubsection{Atmospheric Angular Momentum Observations}
\label{sec:AAM}
\citet{barnesetal1983} derived the following three equations that describe variations in the three components of atmosphere angular momentum:  
\begin{eqnarray}
%X1
{\bf \chi}_{1}(t) &=& \frac{1}{\Omega \left( C_m-A_m \right)\left(1-\frac{k_2}{k_s}  \right)}
\left[ \left(1+k_l \right) \Omega \Delta {\bf I}_{13}(t) + \Delta h_1(t)  \right] \label{eq:X1} \\
%X2	
{\bf \chi}_{2}(t) &=& \frac{1}{\Omega \left( C_m-A_m \right)\left(1-\frac{k_2}{k_s}  \right)}
\left[ \left(1+k_l \right) \Omega \Delta {\bf I}_{23}(t) + \Delta h_2(t)  \right] \label{eq:X2} \\
%X3	
{\bf \chi}_{3}(t) &=& \frac{1}{\Omega C_m \left(1+\frac{4k_2}{3k_s}\frac{C-A}{C} \right)}
\left[ \left(1+k_l \right) \Omega \Delta {\bf I}_{33}(t) + \Delta h_{3}(t) \label{eq:X3} \right].
\end{eqnarray}
%
$\chi_1$ and $\chi_2$ represent the angular momentum vector components defined by the intersection of the equator with the $180\degree$W and $0\degree$ meridians, respectively, and $\chi_3$ reprents the axial component.
%
The constants 
$k_2 = 0.295$, 
$k_s = 0.938$, and 
$k_l = -0.301$
represent the rotational, secular and load Love numbers, which quantify the rotational deformation of the Earth.
$\Omega = 7.292115\times 10^{-5} \text{rad}/\text{s}$ is the average rotation rate  of the Earth. 
$C = 8.0365 \times 10^{37} \text{kg} \text{m}^2$ and $A = 8.0101 \times 10^{37} \text{kg} \text{m}^2$ represent the (3,3) and (1,1) components of the moment of inertia of the solid Earth, and $C_m = 7.1237\times 10^{37}  \text{kg} \text{m}^2$ and $A_m = 7.0999\times 10^{37} \text{kg} \text{m}^2$ are the corresponding moments of inertia of the mantle and crust only (they are used in the above equations to decouple the core and mean mantle motion).  



The ${\bf I}_{ij}$ terms represent the components of the atmospheric inertia tensor:
\begin{eqnarray}
  I_{13} &=& -\int R^2 \cos \phi \sin \phi \cos \lambda dM 
  \label{eq:I1}\\
  I_{23} &=& -\int R^2 \cos \phi \sin \phi \sin \lambda dM 
  \label{eq:I2}\\
  I_{33} &=&  \int R^2 \cos^2 \phi dM ,
  \label{eq:I3}
\end{eqnarray}
and the $h_i$ terms the relative angular momentum (due to wind) in each direction:
\begin{eqnarray}
  h_{1}  &=& -\int R \left[u \sin \phi \cos \lambda - v \sin \lambda \right] dM 
    \label{eq:h1}\\
  h_{2}  &=& -\int R \left[u \sin \phi \sin \lambda + v \cos \lambda \right] dM 
    \label{eq:h2}\\
  h_{3}  &=&  \int R u \cos \phi dM.
    \label{eq:h3}
\end{eqnarray}
%
$R = 6371.0$ km is the radius of the Earth, $\Omega = 7.292115\times 10^{-5} \text{rad}/\text{s}$ the average rotation rate, and $g = 9.81 \text{m}/\text{s}^2$ is the acceleration due to gravity.

Note that the axial terms [(\ref{eq:I3}) and (\ref{eq:h3})] weight all longitudes equally in the integration.
This means that mass anomalies usually cancel each other out in the global integral, which means that the axial wind excitation function $h_3$ dominates the axial angular momentum  \citep{barnesetal1983}.
%
Nearly the opposite is true for the equatorial angular momentum terms [(\ref{eq:I1})-(\ref{eq:I2}) and (\ref{eq:h1})-(\ref{eq:h2})], where zonally-asymmetric fields add up to a larger global integral.
For these functions, the mass terms ($I_1$ and $I_2$) are typically several factors larger than the wind terms ($h_1$ and $h_2$)  \citep{barnesetal1983}.

The longitudinal terms in the equatorial mass integrals [(\ref{eq:I1}) and (\ref{eq:I2})] means that $\chi_2$ is weighted more strongly over the continents while $\chi_1$ is weighted more strongly over the oceans.
Consequently, $\chi_2$ has a pronounced annual cycle due to the yearly appearance of the Siberian High \citep{dobslawetal2010}, and tends to show strong negative anomalies in the month preceding a sudden stratospheric warming \citep{Neef2014}.
$\chi_1$ has much weaker subseasonal to annual variations because surface pressure variations cause corresponding displacements of the ocean surface, which even out the angular momentum changes (the so-called ``inversted barometer'' effect, e.g. \citet{salsteinrosen1989}).

In reality, of course, we don't measure the atmospheric angular momentum but rather the variations in the Earth rotation parameters that variations in the angular momentum excite. 
To map these to equivalent angular momentum variations, one would rotate the inertial reference frame, convert observed length-of-day anomalies into corresponding axial angular momentum, and subtract out the excitation of each parameter that is due to other components of the Earth system.
For the purposes of this study, however, it is sufficient to assimilate the three angular momentum components directly, since we are performing perfect model experiments and therefore know the true state.
%---cut this part: since we assimilate the X's, we don't need to talk about polar motion
%The non-dimensional representation of the angular momentum in (\ref{eq:X1})-(\ref{eq:X3}) makes it easy to map angular momentum changes to equivalent changes in the polar orientation (or polar motion) and the rate of Earth's rotation. 
%Polar motion is measured in terms of two angles, $p_1$ and $p_2$, that represent the location of the Earth's rotational axis in an inertial, celestial reference frame that is fixed in space and defined relative to a group of stars (the so-called celestial ephemeris pole).
%\citet{barnesetal1983} and later \citet{Gross1992} showed that these vectors can be directly related to unit variations in the equatorial components of the Earth's angular momentum ($\chi_1$ and $\chi_2$) via a rotation into the inertial reference frame of the so-called Chandler wobble (a free nutation of the Earth of frequency 
%$\sigma_0 = 2\pi/ 433\text{d}$, which results from the oblateness of the Earth's figure):
%\begin{eqnarray}
%  p_1 + \frac{\dot{p_2}}{\sigma_0} &=& \chi_1 \\
%  -p_2 + \frac{\dot{p_1}}{\sigma_0} &=& \chi_2.
%\label{eq:X12_to_PM}
%\end{eqnarray}
%where the overdots represent time derivatives, $\sigma_0 = 2\pi/ 433\text{d}$ denotes the Chandler frequency.

Nevertheless, it is conceptually helpful to transform the axial angular momentum $\chi_3$ into corresponding anomalies in the length of a day ($\Delta$LOD), which is done using the following relationship:
\begin{eqnarray}
\Delta \text{LOD} &=& \Delta \chi_3 \times \text{LOD}_0 ,
\label{eq:X3_to_LOD}
\end{eqnarray}
where $\text{LOD}_0$ denotes the nominal length-of-day (86400s).  
%----cut----The length-of-day anomalies are observed as $\Delta \text{LOD}  \equiv \text{UT1} - \text{IAT}$ where UT1 denotes the universal time measured by geodetic techniques and IAT is a reference time based on atomic clock measurements.

For our experiments, observations of $\chi_1$, $\chi_2$, and $\chi_3$ are generated every 24 hours, reflecting the observation frequency of the real Earth rotation data series published by the International Earth Rotation Services \citep{iers}.  


\subsubsection{Idealized Radiosonde Observations}
\label{sec:radiosondes}

We compare the angular momentum observations described above to spatially localized observations that are similar to the types of observations used in  reanalysis \citep{Dee2005}.
We simulate the "conventional" observation grid simply using an idealized global grid (Fig. \ref{fig:RS}) of radiosonde measurements of temperature, which amounts to about 27000 observations per day.  



%-------------------experiments-------------------------


\subsection{Assimilation Experiments}
\label{sec:experiments}


\subsubsection{Ensemble Generation}

\textcolor{alert}{[Insert description of how we generated the true state.]}
All assimilation runs were performed with an 80-member ensemble.
The ensemble is generated by selecting the 1 January restart files from an 80-year simulation of CAM5, and then running a year of assimilation of the synthetic radiosonde observations (Section \ref{sec:radiosondes}).

\subsubsection{Experiment Overview}
% experiment types
Four assimilation experiments are performed, summarized in Table \ref{tab:expts}.
As a reference experiment, we have run the 80-member CAM ensemble forward for two months with no assimilation.
In the second experiment, the ensemble is run forward as before, but assimilating the three angular momentum components observed in the "true state" every 12 hours.
Borth of these experiments were integrated for two months, 1 January to 28 February 2009.  
In the third experiment, the temperature observations from the idealized radiosonde grid are assimilated every six hours. 
In the fourth experiment, we assimilate both the 6-hourly radiosonde temperatures and the three 12-hourly global angular momentum components.
These latter two experiments were only integrated for the first 31 and 17 days of this period, respectively, because this amount of integration time was found to be sufficient to give the results presented in this study.

\subsubsection{Output Diagnostics}
Our main evaluation diagnostics are the square error between the simulated true state and the ensemble mean
\begin{eqnarray}
E_M = \left(
\left< x_i \right>-x_{i,t}
\right)^2
\end{eqnarray}
and the ensemble variance about its mean:
\begin{eqnarray}
S = 
\frac{1}{N}
\sum_{n=1}^N
\left(
\left< x_{i,n} \right>-x_t
\right)^2,
\end{eqnarray}
where $x_{i,n}$ represents a component of the state vector in the ensemble,  $x_{i,t}$ the corresponding component in the truth, and $\left< \cdot \right>$ represents the ensemble mean, as in section \ref{sec:DAS}.

In order to evaluate whether the ensemble is an accurate representation of the true uncertainty, we  test whether the truth can be considered a sample of the probability distribution represented by the ensemble.
 \citet{Huntley2009} and \citet{Murphy1988} pointed out that this is the case when 
\begin{eqnarray}
\llbracket E_M \rrbracket = \frac{N+1}{N} \llbracket S \rrbracket, 
\label{eq:EvsS}
\end{eqnarray}
where the square brackets represent spatial averages. 

A second way to quantify whether the ensemble and the truth come from the same probability distribution is to compute rank histograms \citep[and references therein]{Hamill2001}
A rank histogram is generated by ordering the values of the ensemble at each point in the state space, and then finding the rank of some verification value on this list.
In our case, we simply use the true state as the verification, since it is known.
The rank of the verification is then counted up over many different assimilation times and state space points; we then generate a histogram of these ranks.
If the truth comes from the same PDF as the ensemble, the rank histogram should be nearly flat.  
If the truth is a frequent outlier of the PDF represented by the ensemble, the rank histogram will by concave.
A convex rank histogram indicates an ensemble whose spread is so large that the truth is usually the central rank. 

